#!/bin/bash

set -xue

MAKENSIS=/usr/lib/mxe/usr/bin/i686-w64-mingw32.static-makensis

PROJECT_SOURCE_DIR="${PROJECT_SOURCE_DIR-.}"

cp ${PROJECT_SOURCE_DIR}/src/view/images/battleship.ico build-dir

awk 'sub("$", "\r")' ${PROJECT_SOURCE_DIR}/README.md > \
    build-dir/README.txt
awk 'sub("$", "\r")' ${PROJECT_SOURCE_DIR}/LICENSE > \
    build-dir/LICENSE.txt

cd build-dir
$MAKENSIS wizard.nsi
mv battleship_@VERSION@_windows32.exe ../battleship_@VERSION@_$FILENAME_SUFFIX.exe
cd ..

set +xue
